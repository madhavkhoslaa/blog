<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Error handling in Rust. - Madhav Khosla</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" Errors are an inevitable part of any software development process, and Rust provides a robust mechanism for managing and handling them. This blog aims to demystify Rust's error handling philosophy, covering its unique features, error types, and various strategies for effectively dealing with errors."><meta property="og:image" content><meta property="og:title" content="Error handling in Rust."><meta property="og:description" content=" Errors are an inevitable part of any software development process, and Rust provides a robust mechanism for managing and handling them. This blog aims to demystify Rust's error handling philosophy, covering its unique features, error types, and various strategies for effectively dealing with errors."><meta property="og:type" content="article"><meta property="og:url" content="https://madhavkhoslaa.github.io/posts/errors/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-08T02:01:58+05:30"><meta property="article:modified_time" content="2023-06-08T02:01:58+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Error handling in Rust."><meta name=twitter:description content=" Errors are an inevitable part of any software development process, and Rust provides a robust mechanism for managing and handling them. This blog aims to demystify Rust's error handling philosophy, covering its unique features, error types, and various strategies for effectively dealing with errors."><script src=https://madhavkhoslaa.github.io/js/feather.min.js></script>
<link href=https://madhavkhoslaa.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://madhavkhoslaa.github.io/css/main.40ca3a860425083862b7ebd55447caec5c4384573f0cb098b8d06a91e8dace2e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://madhavkhoslaa.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css></head><body><div class=content><header><div class=main><a href=https://madhavkhoslaa.github.io/>Madhav Khosla</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/draft>Draft</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Error handling in Rust.</h1><div class=meta>Posted on Jun 8, 2023</div></div><section class=body><p><img src=https://i.imgur.com/VSG6kWK.jpeg alt=image></p><h1 id=types-of-errors>Types of Errors</h1><ol><li>Unrecoverable Errors</li><li>Recoverable Errors</li></ol><h1 id=how-to-handle-unrecoverable-errors>How to handle unrecoverable Errors.</h1><p>These errors are errors that make you want to stop the execution of the program. Like not being able to find a free port for starting the server, division by zero.
These errors use the <code>panic</code> macro to stop the execution of the program in rust.</p><h2 id=example-of-panic-macro>Example of panic macro.</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> c <span style=color:#f92672>=</span> divide(a, b);
</span></span><span style=display:flex><span>  println!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, c);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>divide</span>(a: <span style=color:#66d9ef>u8</span>, b: <span style=color:#66d9ef>u8</span>) -&gt; <span style=color:#66d9ef>u8</span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(b <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>  panic!(<span style=color:#e6db74>&#34;Division by zero not allowed&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> a<span style=color:#f92672>/</span>b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The result of this code will be a panic with a message <code>Division by zero not allowed</code>.</p><h1 id=how-to-handle-recoverable-errors>How to handle recoverable errors</h1><p>These errors are to be handled at runtime and do not stop the execution of the program. Like an empty file in a directory.
Functions that expect to return a success value or an erroneous value use the <code>Result</code> enum to wrap the values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>enum</span> Result<span style=color:#f92672>&lt;</span>T, E<span style=color:#f92672>&gt;</span>{
</span></span><span style=display:flex><span>  Ok(T), 
</span></span><span style=display:flex><span>  Err(E)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=example-of-using-a-result-enum>Example of using a Result enum</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> data <span style=color:#f92672>=</span> get_database_contents(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> data <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span> data{
</span></span><span style=display:flex><span>        Ok(value) <span style=color:#f92672>=&gt;</span> {value},
</span></span><span style=display:flex><span>        Err(value) <span style=color:#f92672>=&gt;</span> {value}
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, data);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>get_database_contents</span>(id: <span style=color:#66d9ef>usize</span>) -&gt; Result<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> id <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Database success&#34;</span>.to_owned());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Err(<span style=color:#e6db74>&#34;Database fail&#34;</span>.to_owned());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here in the mock function, we return the <code>Ok</code> variant of the enum if the argument is 1 and return the <code>Error</code> variant of the enum in other cases; The caller of the function has the responsibility of handling the enum variants.</p><h1 id=syntactical-sugar-for-early-returning-of-errors-using-the--operator>Syntactical sugar for early returning of errors using the <code>?</code> operator.</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> std::fs::File;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::io::{self, Read};
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>read_file</span>(path: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>String, io::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> file <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span> File::open(path) {
</span></span><span style=display:flex><span>        Ok(file) <span style=color:#f92672>=&gt;</span> file,
</span></span><span style=display:flex><span>        Err(error) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>return</span> Err(error),
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> contents <span style=color:#f92672>=</span> String::new();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> file.read_to_string(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> contents) {
</span></span><span style=display:flex><span>        Ok(_) <span style=color:#f92672>=&gt;</span> Ok(contents),
</span></span><span style=display:flex><span>        Err(error) <span style=color:#f92672>=&gt;</span> Err(error),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> file_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;path/to/your/file.txt&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> read_file(file_path) {
</span></span><span style=display:flex><span>        Ok(contents) <span style=color:#f92672>=&gt;</span> println!(<span style=color:#e6db74>&#34;File contents:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, contents),
</span></span><span style=display:flex><span>        Err(error) <span style=color:#f92672>=&gt;</span> eprintln!(<span style=color:#e6db74>&#34;Error reading file: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, error),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Using Syntactical sugar for returning errors.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> std::fs::File;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::io::Read;
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>read_file</span>(path: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>String, std::io::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> file <span style=color:#f92672>=</span> File::open(path)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> contents <span style=color:#f92672>=</span> String::new();
</span></span><span style=display:flex><span>    file.read_to_string(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> contents)<span style=color:#f92672>?</span>; 
</span></span><span style=display:flex><span>    Ok(contents)
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> file_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;path/to/your/file.txt&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> read_file(file_path) {
</span></span><span style=display:flex><span>        Ok(contents) <span style=color:#f92672>=&gt;</span> println!(<span style=color:#e6db74>&#34;File contents:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, contents),
</span></span><span style=display:flex><span>        Err(error) <span style=color:#f92672>=&gt;</span> println!(<span style=color:#e6db74>&#34;Error reading file: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, error),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=returning-different-types-of-errors>Returning different types of errors.</h1><p>Sometimes you might want to send different types of errors to the function caller in case different errors arise in the execution of the function. Here we have two approaches for the following.</p><h2 id=dynamic-dispatch-approach>Dynamic dispatch approach.</h2><p>In this case, we can use <code>dynamic dispatch</code> on the error type and send different types of errors.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>do_operation</span>(arg: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>String, Box<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>dyn</span> error::Error<span style=color:#f92672>&gt;&gt;</span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> boolean_response() {
</span></span><span style=display:flex><span>    Ok()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> boolean_response_for_error1() {
</span></span><span style=display:flex><span>    Err(Errimp1)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> boolean_response_for_errore() {
</span></span><span style=display:flex><span>    Err(Errorimpl2)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=issue-with-this-approach-of-using-dynamic-dispatch>Issue with this approach of using dynamic dispatch</h3><p>On the runtime we do not know what error type the caller of the function will receive on the runtime hence the error handling will be hard to handle.</p><h2 id=using-error-enums-approach>Using Error Enums approach.</h2><p>We can create an enum with all the values for the enums and then create a match of all the values for the enum.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[derive(PartialEq, PartialOrd)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>APP_FAILURE</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>TIMEOUT</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>NULL_VALUE</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>OTHER_ERROR</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span> (){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> Result <span style=color:#f92672>=</span> result_returning_function();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> Result <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span> Result {
</span></span><span style=display:flex><span>    Ok(value) <span style=color:#f92672>=&gt;</span> {value},
</span></span><span style=display:flex><span>    Err(value) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(value <span style=color:#f92672>==</span> <span style=color:#66d9ef>APP_FAILURE</span>::<span style=color:#66d9ef>TIMEOUT</span>){
</span></span><span style=display:flex><span>        <span style=color:#75715e>//Do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      }
</span></span><span style=display:flex><span>      <span style=color:#75715e>// .. exhaustive comparison list 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>result_returning_function</span>(filename: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>String, <span style=color:#66d9ef>APP_FAILURE</span><span style=color:#f92672>&gt;</span> {}
</span></span></code></pre></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/rust>rust</a></li><li><a href=/tags/erorrs>erorrs</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://bit.ly/3Qyr87Y title=GitHub><i data-feather=github></i></a><a class=soc href=https://bit.ly/3Qtgn6y title=Twitter><i data-feather=twitter></i></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>